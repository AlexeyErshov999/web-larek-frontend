# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## АРХИТЕКТУРА 

Все взаимодействия происходят через события. Модели вызывают события, слушатели событий:
- передают данные компонентам отображения
- выполняют вычисления между передачей
- меняют значения в моделях

# БАЗОВЫЙ КОД

### Класс Api

Через класс `Api` представляется доступа к серверу. Он обеспечивает два основных типа операций:
- операции, которые используют метод GET для получения данных
- операции, которые включают методы POST и DELETE для изменения данных на сервере

### 2. Класс Component

Класс `Component<T>`
Абстрактный класс, который позволяет создавать компоненты пользовательского интерфейса. С помощью класса можно управлять DOM элементами и поведением компонента. Наследуется всеми классами представления (`View`).

`constructor(container: HTMLElement)` - принимает элемент, в который будет помещен компонент.

#### Методы:
  - `toggleClass` - переключение класса
  - `setText` - устанавливка текстового содержимого
  - `setImage` - устанавливает изображения и альтернативный текст
  - `setDisabled` - изменяет статус переданного элемента на `disabled`
  - `setHidden`, `setVisible` - меняют отображение и скрытие
  - `render` - отображает компонент. Метод должен быть переназначен в дочерних классах!

### 3. Класс EventEmitter

Класс `EventEmitter` 
реализует интерфейс IEvents и предназначен для управления событиями. Он предоставляет методы:
- подписки/отписки на события
- инициализации событий
- создания триггеров событий

`constructor() { this._events = new Map<EventName, Set<Subscriber>>(); }` - инициализация хранилища событий и подписчиков.

Методы:

- `on<T extends object>(eventName: EventName, callback: (data: T) => void): void` - Метод используется для подписки на событие. Принимает имя события `eventName` и функцию `callback`, которая будет вызываться при наступлении события.
- `off(eventName: EventName, callback: Subscriber): void` - Метод для отписки от события. Принимает имя события `eventName` и функцию обратного вызова `callback`, которая была использована при подписке на событие.
- `emit<T extends object>(eventName: string, data?: T): void` - Метод инициализации события. Принимает имя события `eventName` и необязательные данные `data`.
- `onAll(callback: (event: EmitterEvent) => void): void` - Метод для подписки на все события. Принимает функцию обратного вызова `callback`, которая будет вызываться при любом событии.
- `offAll(): void` - Метод для отписки от всех событий. Удаляет все подписки на события и очищает хранилище событий и подписчиков.
- `trigger<T extends object>(eventName: string, context?: Partial<T>): (data: T) => void` - Метод создания триггера. Принимает имя события `eventName` и опциональный контекст `context`, который будет добавлен к данным события при инициализации. Возвращает функцию, которая инициализирует событие с переданными данными.

### 4. Класс Model

Класс `Model<T>` 
абстрактный базовым классом для создания моделей данных в сервисе. Он предоставляет базовый функционал для работы с данными и уведомлений о изменениях в данных. Класс наследуется другими классами.

`constructor(data: Partial<T>, protected events: IEvents)` -  Принимает частичные данные типа и объект брокера событий `events`, использующийся для уведомления об изменениях в данных.

Метод:
- `emitChanges` - используется для сообщения об изменениях в модели. Принимает идентификатор события (`event`) и данные (`payload`), связанные с этим событием. Затем метод иммитирует событие через объект брокера событий.

## Классы модели данных
### 1. Класс AppState

Класс `AppState` - данные всего приложения. Позволяет отслеживать его состояние. Содержит следующие свойства:

- `catalog`: для отслеживания списка доступных лотов. Установка данного свойства вызывает событие `catalog:changed`.
- `basket`: для отслеживания лотов, находящихся в корзине.
- `order`: отслеживает состояние заказа.
- `preview`: отслеживает лот, который используется для подробного изучения в модальном окне.

Класс `AppState` также реализует дополнительные методы для доступа к методам выше перечисленных свойств.

### 2. Класс LotItem

Класс `LotItem` - данные отдельной карточки лота. Его структура определяется ответом сервера с добавлением свойств и методов, реализующих логику взаимодействия с корзиной через вызов события `lot:changed`.

### 3. Класс Order

Класс `Order` - данные процесса оформления заказа.
- Содержит свойства, соответствующие полям формы оформления заказа.
- Валидирует эти свойства на наличие значений.
Изменения в любом из свойств вызывают проверку всех полей и генерацию события `formErrors:changed`.

## Компоненты представления

### 1. Класс Basket

Класс `Basket` представляет собой корзину. Он позволяет задать следующие элементы:

- `list`: список элементов в корзине.
- `total`: общую стоимость корзины.
- `button`: кнопку открытия формы оформления заказа. Вызов этой кнопки вызывает событие `order_payment:open`.

### 2. Класс BasketItem

Класс `BasketItem` - элементы корзины. Он позволяет задать следующие свойства:

- `index`: номер элемента в корзине.
- `title`: название элемента.
- `price`: стоимость элемента.
- `deleteBtn`: кнопку удаления элемента из корзины.

### 3. Класс Card

Класс `Card` - это карточка каждого лота.

### 4. Класс ContactsForm

Класс `ContactsForm` наследуется от класса `Form` и представляет форму оформления заказа с контактной информацией.

Он позволяет задать следующие свойства:

- `email`: почта.
- `phone`: телефон.

### 5. Класс DeliveryForm

Класс `DeliveryForm` наследуется от класса `Form` и представляет форму оформления заказа с информацией об способе оплаты и адресом доставки.

Он позволяет задать следующие свойства:

- `payment`: способ оплаты.
- `address`: адрес доставки.

### 6. Класс Form

Класс `Form` - базовая форма. Он позволяет задать следующие элементы:

- `submit`: кнопка отправки формы.
- `errors`: отображение ошибок валидации.

На все отображение привязывается событие `input` для вызова событий вида `container.field:change` и событие `container:submit`.

### 7. Класс Modal

Класс `Modal` - модальное окно. Он позволяет задать следующие элементы:

- `content`: отображение внутреннего содержимого модального окна.
- `closeButton`: для отображения кнопки закрытия модалки.

Класс привязывает событие закрытия модального окна `modal:close` к кликам по кнопке закрытия формы и по родительскому контейнеру модального окна.

### 8. Класс Page

Класс `Page` - всея страница. Он позволяет задать следующие элементы:

- `counter`: отображение количества товаров в корзине.
- `gallery`: отображение доступных лотов.
- `wrapper`: обёртка, позволяющая блокировать прокрутку страницы при открытии модального окна.
- `basket`: кнопка отображения корзины. Клик по кнопке вызывает событие `basket:open`.

### 9. Класс Success

Класс `Success` определяет отображение основной информации об оформленном заказе, такой как общая сумма заказа.

## СВЯЗИ

### LarekAPI

**Методы:**
- `getLotItem`: Запрос информации по лоту.
- `getLotList`: Запрос информации по всем лотам.
- `postOrderLots`: Оформление заказа.

## Типы данных
```typescript
Интерфейс лота:

interface ILot {
	id: string; // идентификационный номер лота
	title: string; //имя лота
	description: string; //описание лота
	image: string; //картинка лота
	category: ILotCategory; //категория лота
	price: number; //стоимость лота
	isOrdered: boolean; //показывает заказан лот или нет
	placeInBasket: () => void; //размещает лот в корзине
	removeFromBasket: () => void; //удаляет лот из корзины
}

Интерфейс приложения:

interface IAppState {
    catalog: ILot[]; // каталог лотов
    basket: ILot[]; // лоты в корзине
    order: IOrder; // заказ
    preview: ILot; // предпросмотр лота
    isLotInBasket(item: ILot): boolean; // проверка находится ли лот в корзине
    clearBasket(): void; // очистка корзины
    getTotalAmount(): number; // получение стоимости корзины
    getBasketIds(): number[]; // получение списка индексов лотов в корзине
    getBasketLength(): number; // получение количества товаров в корзине
    initOrder(): IOrder; // инициализация объекта заказа
}

Модель заказа:

interface IOrder {
    payment: IPaymentType; // тип оплаты заказа
    address: string; // адрес доставки
    email: string; // почта
    phone: string; // телефон
    items: ILot[]; // объекты лотов в корзине
    formErrors: IFormErrors; // ошибки валидации формы
    validateOrder(): void; // валидация полей формы
    clearOrder(): void; // очистка заказа
    validatePayment(): void; // валидация способа оплаты
    validateAddress(): void; // валидация адреса доставки
    validateEmail(): void; // валидация почты
    validatePhone(): void; // валидация телефона
    postOrder(): void; // отправка заказа
}

События:

enum Events {
    // загрузка доступные лоты
	LOAD_LOTS = 'catalog:changed',
    // открытие карточки лота для просмотра
	OPEN_LOT = 'card:open',
    // открытие корзину
	OPEN_BASKET = 'basket:open',
    // добавление/удаление лота из корзины
	CHANGE_LOT_IN_BASKET = 'lot:changed',
    // валидация формы отправки
	VALIDATE_ORDER = 'formErrors:changed',
    // начинаем оформление заказа
	OPEN_FIRST_ORDER_PART = 'order_payment:open',
    // заполнение первой формы
	FINISH_FIRST_ORDER_PART = 'order:submit',
    // продолжаем оформление заказа
	OPEN_SECOND_ORDER_PART = 'order_contacts:open',
    // окончание заполнения второй формы
	FINISH_SECOND_ORDER_PART = 'contacts:submit',
    // завершение заказ
	PLACE_ORDER = 'order:post',
    // выбор способа оплаты
	SELECT_PAYMENT = 'payment:changed',
    // ввод адреса доставки
	INPUT_ORDER_ADDRESS = 'order.address:change',
    // ввод почты
	INPUT_ORDER_EMAIL = 'contacts.email:change',
    // ввод телефона
	INPUT_ORDER_PHONE = 'contacts.phone:change',
    // открытие модального окна
	OPEN_MODAL = 'modal:open',
    // закрытие модального окна
	CLOSE_MODAL = 'modal:close'
}
